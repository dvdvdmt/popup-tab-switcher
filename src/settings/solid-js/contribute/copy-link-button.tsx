import {createSignal, onCleanup} from 'solid-js'
import {Show} from 'solid-js/web'

interface IProps {
  textToCopy: string
  class?: string
  testId?: string
}

export function CopyLinkButton(props: IProps) {
  let isCopiedTimeout: number
  const [isCopied, setIsCopied] = createSignal(false)
  onCleanup(disposeTimeout)
  return (
    <button
      class={props.class}
      onClick={copyLink}
      data-test={props.testId}
      title="Copy link to extension"
    >
      <Show when={isCopied()} fallback={<LinkIcon />}>
        <LinkIconCopied />
      </Show>
    </button>
  )

  async function copyLink() {
    disposeTimeout()
    await navigator.clipboard.writeText(props.textToCopy)
    setIsCopied(true)
    isCopiedTimeout = window.setTimeout(() => setIsCopied(false), 2000)
  }

  function disposeTimeout() {
    clearTimeout(isCopiedTimeout)
  }
}

function LinkIconCopied() {
  return (
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M9.82848 6.99997C9.43798 7.39047 9.43798 8.02367 9.82848 8.41417C10.2191 8.80467 10.8521 8.80467 11.2428 8.41417L14.0711 5.58577C14.8521 4.80467 16.1185 4.80467 16.8996 5.58577L18.3138 6.99997C19.0948 7.78097 19.0948 9.04737 18.3138 9.82837L18.1889 9.95328C18.9616 9.97598 19.7068 10.1082 20.4094 10.3351C21.2414 8.81637 21.0143 6.87197 19.728 5.58577L18.3138 4.17158C16.7517 2.60948 14.2191 2.60948 12.657 4.17158L9.82848 6.99997ZM9.95328 18.1888C9.97598 18.9615 10.1081 19.7067 10.3349 20.4093C8.81627 21.2413 6.87197 21.0142 5.58577 19.7279L4.17158 18.3137C2.60948 16.7516 2.60948 14.2189 4.17158 12.6568L6.99997 9.82837C7.39057 9.43787 8.02368 9.43787 8.41428 9.82837C8.80478 10.2189 8.80478 10.8521 8.41428 11.2426L5.58577 14.071C4.80477 14.8521 4.80477 16.1184 5.58577 16.8995L6.99997 18.3137C7.78107 19.0948 9.04748 19.0948 9.82848 18.3137L9.95328 18.1888ZM14.657 10.6568C12.8855 11.4579 11.4579 12.8855 10.6567 14.657L9.47488 15.8388C9.08428 16.2293 8.45127 16.2293 8.06058 15.8388C7.67007 15.4483 7.67007 14.8151 8.06058 14.4246L14.4247 8.06058C14.8152 7.67007 15.4483 7.67007 15.8388 8.06058C16.2293 8.45118 16.2293 9.08428 15.8388 9.47488L14.657 10.6568ZM17.9498 23.9498C21.2635 23.9498 23.9498 21.2636 23.9498 17.9498C23.9498 14.6361 21.2635 11.9498 17.9498 11.9498C14.6361 11.9498 11.9498 14.6361 11.9498 17.9498C11.9498 21.2636 14.6361 23.9498 17.9498 23.9498ZM21.6732 16.6403C22.0545 16.2408 22.0398 15.6078 21.6402 15.2265C21.2408 14.8451 20.6078 14.8599 20.2264 15.2593L17.1316 18.5016L15.6732 16.9736C15.2918 16.5741 14.6588 16.5594 14.2594 16.9408C13.8598 17.3221 13.8451 17.9551 14.2264 18.3546L16.4083 20.6403C16.597 20.838 16.8584 20.9498 17.1316 20.9498C17.4049 20.9498 17.6662 20.838 17.855 20.6403L21.6732 16.6403Z"
      />
    </svg>
  )
}

function LinkIcon() {
  return (
    <svg v-else width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M9.82848 7.00007C9.43798 7.39057 9.43798 8.02377 9.82848 8.41427C10.2191 8.80477 10.8521 8.80477 11.2428 8.41427L14.0711 5.58588C14.8521 4.80478 16.1185 4.80478 16.8996 5.58588L18.3138 7.00007C19.0948 7.78107 19.0948 9.04737 18.3138 9.82847L15.4853 12.6569C15.0948 13.0474 15.0948 13.6806 15.4853 14.0711C15.8759 14.4616 16.509 14.4616 16.8996 14.0711L19.728 11.2427C21.2901 9.68058 21.2901 7.14788 19.728 5.58588L18.3138 4.17158C16.7517 2.60948 14.2191 2.60948 12.657 4.17158L9.82848 7.00007ZM6.99997 9.82847C7.39057 9.43797 8.02368 9.43797 8.41428 9.82847C8.80478 10.219 8.80478 10.8522 8.41428 11.2427L5.58577 14.0711C4.80477 14.8522 4.80477 16.1185 5.58577 16.8995L6.99997 18.3138C7.78107 19.0948 9.04748 19.0948 9.82848 18.3138L12.6568 15.4853C13.0475 15.0948 13.6805 15.0948 14.0711 15.4853C14.4616 15.8759 14.4616 16.509 14.0711 16.8995L11.2426 19.728C9.68048 21.2901 7.14787 21.2901 5.58577 19.728L4.17158 18.3138C2.60948 16.7517 2.60948 14.219 4.17158 12.6569L6.99997 9.82847ZM8.06058 15.8389C7.67007 15.4484 7.67007 14.8152 8.06058 14.4247L14.4247 8.06068C14.8152 7.67018 15.4483 7.67018 15.8388 8.06068C16.2293 8.45118 16.2293 9.08437 15.8388 9.47487L9.47488 15.8389C9.08428 16.2294 8.45128 16.2294 8.06058 15.8389Z"
      />
    </svg>
  )
}
